(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{155:function(e,t,a){e.exports=a.p+"static/media/frontdor_logo.37956169.png"},161:function(e,t,a){e.exports=a(305)},220:function(e,t){},303:function(e,t,a){},305:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(30),c=a.n(s),o=a(3),i=a.n(o),l=a(9),m=a(19),u=a(12),p=a(13),d=a(15),v=a(14),h=a(16),f=a(29),g=a(38),b=a(306),E=a(155),C=a.n(E);var N=function(){return r.a.createElement(b.a,{className:"landingPageDiv"},r.a.createElement("img",{src:C.a,alt:"Logo Placeholder",className:"logoImage"}),r.a.createElement("h2",{className:"landingPageHeader"},"FrontDor"),r.a.createElement(f.b,{to:"/login",className:"authLink"},"Login"),r.a.createElement(f.b,{to:"/register",className:"authLink"},"Register"))},x=a(5),y=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(d.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).state={email:"",password:"",error:null},a.handleInput=function(e){var t;a.setState((t={},Object(m.a)(t,e.target.name,e.target.value),Object(m.a)(t,"error",null),t))},a.handleSubmit=function(e){e.preventDefault(),x.fc.authenticate({strategy:"local",email:a.state.email,password:a.state.password}).catch(function(e){a.setState({error:e})})},a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return this.props.token?r.a.createElement(g.a,{to:"/home"}):r.a.createElement("div",{className:"formContainer"},r.a.createElement("h1",null,"Login"),this.state.error?r.a.createElement("p",null,this.state.error.message):"",r.a.createElement("form",null,r.a.createElement("div",{className:"formRow"},r.a.createElement("label",{htmlFor:"email"},"Email"),r.a.createElement("input",{className:"formInput",id:"email",name:"email",type:"text",placeholder:"email",required:!0,onChange:this.handleInput})),r.a.createElement("br",null),r.a.createElement("div",{className:"formRow"},r.a.createElement("label",{htmlFor:"password"},"Password"),r.a.createElement("input",{className:"formInput",id:"password",type:"password",name:"password",placeholder:"password",required:!0,onChange:this.handleInput})),r.a.createElement("br",null),r.a.createElement("div",{className:"formRow"},r.a.createElement("button",{className:"formBtn",onClick:this.handleSubmit},"Login"))),r.a.createElement(f.b,{to:"/register"},"new here? Register"))}}]),t}(r.a.Component),w=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(d.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).state={email:"",password:"",name:"",loading:!1,error:null},a.handleInput=function(e){a.setState(Object(m.a)({},e.target.name,e.target.value))},a.login=function(){x.fc.authenticate({strategy:"local",email:a.state.email,password:a.state.password}).catch(function(e){return a.setState({error:e})})},a.handleSubmit=function(){var e=Object(l.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),x.fc.service("users").create({name:a.state.name,email:a.state.email,password:a.state.password}).then(function(e){a.login()}).catch(function(e){a.setState({error:e})});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return this.props.token?r.a.createElement(g.a,{to:"/home"}):r.a.createElement("div",{className:"formContainer"},r.a.createElement("h1",null,"Register"),r.a.createElement("form",null,r.a.createElement("div",{className:"formRow"},r.a.createElement("label",{htmlFor:"name"},"Full Name"),r.a.createElement("input",{className:"formInput",id:"name",name:"name",type:"text",placeholder:"name",autoFocus:!0,required:!0,onChange:this.handleInput})),r.a.createElement("br",null),r.a.createElement("div",{className:"formRow"},r.a.createElement("label",{htmlFor:"email"},"Email"),r.a.createElement("input",{className:"formInput",id:"email",name:"email",type:"text",placeholder:"email",required:!0,onChange:this.handleInput})),r.a.createElement("br",null),r.a.createElement("div",{className:"formRow"},r.a.createElement("label",{htmlFor:"password"},"Password"),r.a.createElement("input",{className:"formInput",id:"password",type:"password",name:"password",placeholder:"password",required:!0,onChange:this.handleInput})),r.a.createElement("br",null),r.a.createElement("div",{className:"formRow"},r.a.createElement("button",{className:"formBtn",onClick:this.handleSubmit},"Register"))),r.a.createElement(f.b,{to:"/login"},"already member? Login"))}}]),t}(r.a.Component),k=a(159),I=a(318),O=a(307),j=a(308),S=a(309),M=a(310),T=a(311),_=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(d.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).state={modal:!1,user:x.fc.get("user")},a.toggle=function(){a.setState({modal:!a.state.modal})},a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"vw-100 vh-100 flex-center flex-column"},r.a.createElement("div",{className:"jumbotron w-50 text-center"},r.a.createElement("h1",{className:"display-4"},"Welcome ",r.a.createElement("span",{role:"img","aria-label":"welcome"},"\ud83d\udc4b")),r.a.createElement("h4",{className:""},"Please feel free to create a team or wait until someone else adds you to their team!"),r.a.createElement("hr",null),r.a.createElement(k.a,{className:"teamCreateBtn",onClick:this.toggle},"Create Team")),r.a.createElement(I.a,{isOpen:this.state.modal,toggle:this.toggle},r.a.createElement(O.a,{toggle:this.toggle},"Please Enter a Team Name"),r.a.createElement(j.a,null,r.a.createElement(S.a,null,r.a.createElement(M.a,{value:this.props.teamName,onChange:this.props.teamNameInput,name:"teamInput",type:"text",placeholder:"Team name",className:"firstCreateTeamInput"}))),r.a.createElement(T.a,null,r.a.createElement(k.a,{className:"teamCreateBtn",onClick:this.props.teamCreate},"Create Team"),r.a.createElement(k.a,{className:"cancelBtn",onClick:this.toggle},"Cancel"))))}}]),t}(n.Component),U=a(319),D=a(312),B=a(313),F=a(314),G=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(d.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).state={teamName:""},a.changeHandler=function(e){a.setState({teamName:e.target.value})},a.createTeam=function(e){e.preventDefault(),x.fc.service("teams").create({name:a.state.teamName}).then(function(e){a.setState({teamName:""}),a.props.toggle()})},a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(I.a,{isOpen:this.props.modalState,toggle:this.props.toggle,className:this.props.className},r.a.createElement(O.a,{toggle:this.props.toggle},"Create a New Team"),r.a.createElement(j.a,null,r.a.createElement(S.a,null,r.a.createElement(M.a,{placeholder:"Enter New Team Name",value:this.state.teamName,onChange:this.changeHandler}))),r.a.createElement(T.a,null,r.a.createElement(k.a,{color:"secondary",onClick:this.createTeam},"Create Team"),r.a.createElement(k.a,{color:"cancelBtn",onClick:this.props.toggle},"Cancel"))))}}]),t}(r.a.Component),q=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(d.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).state={dropdownOpen:!1,modal:!1,teams:[]},a.logout=function(){x.fc.logout()},a.toggle=function(){a.setState({dropdownOpen:!a.state.dropdownOpen})},a.toggleModal=function(){a.setState({modal:!a.state.modal})},a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.getTeams()}},{key:"componentDidUpdate",value:function(e,t){var a=this,n=[];x.fc.service("users").find({query:{_id:this.props.activeUser._id}}).then(function(){var e=Object(l.a)(i.a.mark(function e(t){var r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.state.teams||a.state.teams.length===t.data[0].teamIds.length){e.next=9;break}r=0;case 2:if(!(r<t.data[0].teamIds.length)){e.next=8;break}return e.next=5,x.fc.service("teams").find({query:{_id:t.data[0].teamIds[r]}}).then(function(){var e=Object(l.a)(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.push(t.data[0]);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 5:r++,e.next=2;break;case 8:a.setState({teams:n});case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())}},{key:"getTeams",value:function(){var e=Object(l.a)(i.a.mark(function e(){var t,a,n,r=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=[],a=i.a.mark(function e(a){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.fc.service("users").find({query:{_id:r.props.activeUser._id}}).then(function(){var e=Object(l.a)(i.a.mark(function e(n){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.fc.service("teams").find({query:{_id:n.data[0].teamIds[a]}}).then(function(){var e=Object(l.a)(i.a.mark(function e(a){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.push(a.data[0]);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}},e)}),n=0;case 3:if(!(n<this.props.activeUser.teamIds.length)){e.next=8;break}return e.delegateYield(a(n),"t0",5);case 5:n++,e.next=3;break;case 8:console.log(t),this.setState({teams:t});case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state.dropdownOpen,a=this.props.teamName;return r.a.createElement("div",{className:"teamDropDown sticky-top"},r.a.createElement("div",{className:"d-flex justify-content-center mb-4 dropDown"},r.a.createElement(U.a,{className:"switchTeamBtn",isOpen:t,toggle:this.toggle},r.a.createElement(D.a,{caret:!0},a),r.a.createElement(B.a,null,this.state.teams&&this.state.teams.map(function(t,a){return r.a.createElement(F.a,{key:a,onClick:e.props.teamChange,value:t._id},t.name)}),r.a.createElement(F.a,{onClick:this.toggleModal},"Create Team"),r.a.createElement(F.a,{onClick:this.logout},"Logout"))),r.a.createElement(G,{activeUser:this.props.activeUser,modalState:this.state.modal,toggle:this.toggleModal})))}}]),t}(r.a.Component),A=function(e){return r.a.createElement("div",null,r.a.createElement(I.a,{isOpen:e.modalStatus,toggle:e.toggle,className:e.className},r.a.createElement(O.a,{toggle:e.toggle},"Create a New Group"),r.a.createElement(j.a,null,r.a.createElement(S.a,null,r.a.createElement(M.a,{placeholder:"Enter New Group Name",value:e.value,onChange:e.groupNameHandler}))),r.a.createElement(T.a,null,r.a.createElement(k.a,{color:"secondary",onClick:e.addGroup},"Create Group"),r.a.createElement(k.a,{color:"cancelBtn",onClick:e.toggle},"Cancel"))))},H=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("div",{className:"px-2 d-flex justify-content-between align-items-center"},r.a.createElement("h6",{className:"text-muted"},"Groups"),r.a.createElement("button",{onClick:this.props.toggleModal,className:"addBtn"},r.a.createElement("i",{className:"material-icons",style:{fontSize:"20px",color:"grey"}}," add_circle_outline "))),r.a.createElement(A,Object.assign({toggle:this.props.toggleModal},this.props)))}}]),t}(r.a.Component),z=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(I.a,{isOpen:this.props.modalStatus,toggle:this.props.toggle,className:this.props.className},r.a.createElement(O.a,{toggle:this.props.toggle},"Invite a New User"),r.a.createElement(j.a,null,r.a.createElement(S.a,null,r.a.createElement(M.a,{placeholder:"Enter their email address",value:this.props.userEmail,onChange:this.props.emailChange}))),r.a.createElement(T.a,null,r.a.createElement(k.a,{color:"secondary",onClick:this.props.addMember},"Invite User"),r.a.createElement(k.a,{color:"cancelBtn",onClick:this.props.toggle},"Cancel"))))}}]),t}(r.a.Component);var R=function(e){return r.a.createElement("div",null,r.a.createElement("div",{className:"px-2 d-flex justify-content-between align-items-center"},r.a.createElement("h6",{className:"text-muted"},"Members"),r.a.createElement("button",{onClick:e.toggleModal,className:"addBtn"},r.a.createElement("i",{className:"material-icons",style:{fontSize:"20px",color:"grey"}},"add_circle_outline"))),r.a.createElement(z,Object.assign({toggle:e.toggleModal},e)))},L=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(d.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).state={smsNumber:""},a.changeHandler=function(e){a.setState({smsNumber:e.target.value})},a.connectSMS=function(e){e.preventDefault(),x.fc.service("teams").patch(a.props.activeTeamId,{smsNumber:a.state.smsNumber}).then(function(e){a.setState({smsNumber:""}),a.props.toggle()})},a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(I.a,{isOpen:this.props.modalState,toggle:this.props.toggle,className:this.props.className},r.a.createElement(O.a,{toggle:this.props.toggle},"Connect Customer SMS"),r.a.createElement(j.a,null,r.a.createElement(S.a,null,r.a.createElement(M.a,{placeholder:"Enter your FrontDor SMS number. Format: +17708480092",value:this.state.smsNumber,onChange:this.changeHandler}))),r.a.createElement(T.a,null,r.a.createElement(k.a,{color:"secondary",onClick:this.connectSMS},"Connect"),r.a.createElement(k.a,{color:"cancelBtn",onClick:this.props.toggle},"Cancel"))))}}]),t}(r.a.Component),J=function(e){return r.a.createElement("div",null,r.a.createElement("div",{className:"px-2 d-flex justify-content-between align-items-center"},r.a.createElement("h6",{className:"text-muted"},e.teamSMS.length<10?"Customers":e.teamSMS),r.a.createElement("button",{onClick:e.toggle,className:"addBtn"},r.a.createElement("i",{className:"material-icons",style:{fontSize:"20px",color:"grey"}},"add_circle_outline"))),r.a.createElement(L,{activeTeamId:e.activeTeamId,activeUser:e.activeUser,modalState:e.modalState,toggle:e.toggle}))},P=a(315),$=a(316),W=function(e){return r.a.createElement(P.a,{className:"sendMessage",inline:!0},r.a.createElement($.a,null,r.a.createElement(M.a,{className:"sendInput",onChange:e.changeHandler,value:e.value,type:"text"}),r.a.createElement(k.a,{color:"secondary",className:"sendBtn",onClick:e.clickHandler,type:"submit"},"Send")))},V=(a(240),function(e){return"incoming"===e.convoType?e.id?r.a.createElement("div",{className:"row justify-content-end bounce-in-left"},r.a.createElement("div",{className:"card messageBubble myMessage text-white"},r.a.createElement("div",{className:"card-body"},r.a.createElement("p",{className:"card-text message-text"},e.body),r.a.createElement("h5",{className:"card-title message-sender senderName"},e.name)))):r.a.createElement("div",{className:"card messageBubble theirMessage bounce-in-right"},r.a.createElement("div",{className:"card-body"},r.a.createElement("h5",{className:"card-title message-sender"},e.name),r.a.createElement("p",{className:"card-text message-text"},e.body))):e.id===e.activeUser._id?r.a.createElement("div",{className:"row justify-content-end bounce-in-left"},r.a.createElement("div",{className:"card messageBubble myMessage text-white"},r.a.createElement("div",{className:"card-body"},r.a.createElement("p",{className:"card-text message-text"},e.body),r.a.createElement("h5",{className:"card-title message-sender senderName"},e.name)))):r.a.createElement("div",{className:"card messageBubble theirMessage bounce-in-right"},r.a.createElement("div",{className:"card-body"},r.a.createElement("h5",{className:"card-title message-sender"},e.name),r.a.createElement("p",{className:"card-text message-text"},e.body)))}),Y=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(d.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).scrollToBottom=function(){a.messagesEnd.scrollIntoView({behavior:"smooth"})},a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(e){this.props.messages.length!==e.messages.length&&this.scrollToBottom()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"conversation-body"},this.props.messages&&this.props.messages.map(function(t){return r.a.createElement(V,{key:t._id,convoType:e.props.convoType,name:t.senderName,body:t.body,activeUser:e.props.activeUser,id:t.senderId})}),r.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(t){e.messagesEnd=t}}))}}]),t}(r.a.Component),K=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(d.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).state={messageInput:""},a.changeHandler=function(e){a.setState({messageInput:e.target.value})},a.clickHandler=function(e){e.preventDefault(),x.fc.service("messages").create({body:a.state.messageInput,senderId:a.props.activeUser._id,senderName:a.props.activeUser.name,conversationId:a.props.conversationId}).then(function(e){a.setState({messageInput:""})})},a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Y,{convoType:this.props.convoType,messages:this.props.messages,activeUser:this.props.activeUser}),r.a.createElement("div",{className:"px-4 border-top d-flex pb-4 bg-light conversation-view-footer fixed-bottom"},r.a.createElement(W,{changeHandler:this.changeHandler,clickHandler:this.clickHandler,value:this.state.messageInput})))}}]),t}(r.a.Component),Q=a(317),X=(a(302),function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this.props.conversation;return e?r.a.createElement("div",{className:"col-8 pl-0 pr-0",id:"conversation-view"},r.a.createElement(Q.a,{className:"navbar bg-light d-flex justify-content-center sticky-top"},r.a.createElement("span",{className:"navbar-brand",href:"#"},"member"===e.type?e.name.replace(this.props.activeUser.name,"").trim():e.name)),r.a.createElement(K,Object.assign({convoType:e.type},this.props))):r.a.createElement("div",{className:"col-8 pl-0 pr-0",id:"conversation-view"},r.a.createElement(Q.a,{className:"navbar bg-light d-flex justify-content-center sticky-top"},r.a.createElement("span",{className:"navbar-brand",href:"#"},"Welcome, "+this.props.activeUser.name)),r.a.createElement(K,Object.assign({convoType:""},this.props)))}}]),t}(r.a.Component)),Z=function(e){var t=e.status[e.activeUserId];return e.activeConvoId===e._id?r.a.createElement("div",{className:"border teamListItem activeConvo fade-in",id:e._id,onClick:e.openConversation},r.a.createElement("i",{className:"material-icons notifyDot "+t,style:{fontSize:"20px"}},"fiber_manual_record"),r.a.createElement("h5",{className:"listName"},e.name),r.a.createElement("div",{className:"previewText text-muted"},e.preview),r.a.createElement("div",{className:"elapsedTime"},e.timestamps)):r.a.createElement("div",{className:"border teamListItem slide-in-bck-center",id:e._id,onClick:e.openConversation},r.a.createElement("i",{className:"material-icons notifyDot "+t,style:{fontSize:"20px"}},"fiber_manual_record"),r.a.createElement("h5",{className:"listName"},e.name),r.a.createElement("div",{className:"previewText text-muted"},e.preview),r.a.createElement("div",{className:"elapsedTime"},e.timestamps))},ee=function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(d.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).state={messages:[],teamMembers:[],teamName:"",teamSMS:"",groupConvos:[],memberConvos:[],customerConvos:[],messageView:!1,activeConversation:null,activeConvoId:"",groupName:"",groupModal:!1,userEmail:"",userModal:!1,connectSMSModal:!1},a.unreadToUnreplied=Object(l.a)(i.a.mark(function e(){var t,n,r,s,c,o,l,u;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.props.activeTeamId,n=a.props.activeUser._id,r="status.".concat(n),"unread"!==a.state.activeConversation.status[n]){e.next=30;break}return e.next=6,x.fc.service("conversations").patch(a.state.activeConvoId,Object(m.a)({},r,"unreplied"));case 6:if(s=e.sent,"member"!==(c=s.type)){e.next=16;break}return e.next=11,a.getMemberConvos(t,a.props.activeUser);case 11:return o=e.sent,e.next=14,a.setState({memberConvos:o});case 14:e.next=30;break;case 16:if("group"!==c){e.next=24;break}return e.next=19,a.getGroupConvos(t,a.props.activeUser);case 19:return l=e.sent,e.next=22,a.setState({groupConvos:l});case 22:e.next=30;break;case 24:if("incoming"!==c){e.next=30;break}return e.next=27,a.getCustomerConvos(t,a.props.activeUser);case 27:return u=e.sent,e.next=30,a.setState({customerConvos:u});case 30:case"end":return e.stop()}},e)})),a.getMemberConvos=function(){var e=Object(l.a)(i.a.mark(function e(t,n){var r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.fc.service("conversations").find({query:{teamId:t,userIds:n._id,type:"member"}});case 2:if(!((r=e.sent).data.length>0)){e.next=9;break}return e.next=6,a.removeMyNameFromDisplayedMemberConvoName(r.data,n);case 6:r=e.sent,e.next=10;break;case 9:r=r.data;case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.getGroupConvos=function(){var e=Object(l.a)(i.a.mark(function e(t,a){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.fc.service("conversations").find({query:{teamId:t,userIds:a._id,type:"group"}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.getCustomerConvos=function(){var e=Object(l.a)(i.a.mark(function e(t,a){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.fc.service("conversations").find({query:{teamId:t,userIds:a._id,type:"incoming"}});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.getTeamMembers=function(){var e=Object(l.a)(i.a.mark(function e(t){var a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.fc.service("users").find({query:{teamIds:t}});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.getTeam=function(){var e=Object(l.a)(i.a.mark(function e(t){var a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.fc.service("teams").get(t);case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.removeMyNameFromDisplayedMemberConvoName=function(e,t){for(var a=1;a<e.length;a++)e[a].name=e[a].name.replace(t.name,"").trim();return e},a.createNewPersonalConversation_OnJoinTeam=function(){var e=Object(l.a)(i.a.mark(function e(t,a){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.fc.service("conversations").create({teamId:t,type:"member",name:a.name+" (you)",userIds:a._id,status:Object(m.a)({},a._id,"replied")});case 2:e.sent;case 3:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.createNewMember2MemberConversations_OnJoinTeam=function(){var e=Object(l.a)(i.a.mark(function e(t,a,n){var r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=0;case 1:if(!(r<t.length)){e.next=9;break}if(n._id===t[r]._id){e.next=6;break}return e.next=5,x.fc.service("conversations").create({name:n.name+" "+t[r].name,userIds:[n._id,t[r]._id],type:"member",teamId:a,status:Object(m.a)({},n._id,"replied")});case 5:e.sent;case 6:r++,e.next=1;break;case 9:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),a.addNewMemberToAllGroupConversations_OnJoinTeam=function(){var e=Object(l.a)(i.a.mark(function e(t,a){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.fc.service("conversations").patch(null,{$push:{userIds:a._id}},{query:{teamId:t,type:"group"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.initializeGroupConvoStatus_IfNeeded=function(){var e=Object(l.a)(i.a.mark(function e(t,a){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<t.length)){e.next=11;break}if(t[n].status||(t[n].status={}),t[n].status[a._id]){e.next=8;break}return t[n].status[a._id]="replied",e.next=7,x.fc.service("conversations").patch(t[n]._id,{status:Object(m.a)({},a._id,"replied")});case 7:e.sent;case 8:n++,e.next=1;break;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.intializeMemberConvoStatus_IfNeeded=function(){var e=Object(l.a)(i.a.mark(function e(t,a){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<t.length)){e.next=10;break}if(t[n].status||(t[n].status={}),t[n].status[a._id]){e.next=7;break}return t[n].status[a._id]="replied",e.next=7,x.fc.service("conversations").patch(t[n]._id,{status:Object(m.a)({},a._id,"replied")});case 7:n++,e.next=1;break;case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.initializeCustomerConvoStatus_IfNeeded=function(){var e=Object(l.a)(i.a.mark(function e(t,a){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<t.length)){e.next=10;break}if(t[n].status||(t[n].status={}),t[n].status[a._id]){e.next=7;break}return t[n].status[a._id]="replied",e.next=7,x.fc.service("conversations").patch(t[n]._id,{status:Object(m.a)({},a._id,"replied")});case 7:n++,e.next=1;break;case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.getData=function(){var e=Object(l.a)(i.a.mark(function e(t,n){var r,s,c,o,l,m;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getTeam(t);case 2:return r=e.sent,s=r.name,e.next=6,a.getTeamMembers(t);case 6:return c=e.sent,e.next=9,a.getGroupConvos(t,n);case 9:return o=e.sent,e.next=12,a.getMemberConvos(t,n);case 12:return l=e.sent,e.next=15,a.getCustomerConvos(t,n);case 15:if(m=e.sent,0!==l.length){e.next=24;break}return e.next=19,a.createNewPersonalConversation_OnJoinTeam(t,n);case 19:return e.next=21,a.createNewMember2MemberConversations_OnJoinTeam(c,t,n);case 21:return e.next=23,a.getMemberConvos(t,n._id);case 23:l=e.sent;case 24:if(0!==o.length){e.next=28;break}return e.next=27,a.addNewMemberToAllGroupConversations_OnJoinTeam(t,n);case 27:o=e.sent;case 28:return e.next=30,a.initializeGroupConvoStatus_IfNeeded(o,n);case 30:return o=e.sent,e.next=33,a.intializeMemberConvoStatus_IfNeeded(l,n);case 33:return l=e.sent,e.next=36,a.initializeCustomerConvoStatus_IfNeeded(m,n);case 36:m=e.sent,a.setState({teamMembers:c,teamName:s,teamSMS:r.smsNumber||"",groupConvos:o,memberConvos:l,customerConvos:m||[]});case 38:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.updateStateForNewMessage=function(){var e=Object(l.a)(i.a.mark(function e(t){var n,r,s,c,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.fc.service("conversations").get(t.conversationId);case 2:if(n=e.sent,"member"!==(r=n.type)){e.next=11;break}return e.next=7,a.getMemberConvos(a.props.activeTeamId,a.props.activeUser);case 7:s=e.sent,a.setState({memberConvos:s}),e.next=23;break;case 11:if("group"!==r){e.next=18;break}return e.next=14,a.getGroupConvos(a.props.activeTeamId,a.props.activeUser);case 14:c=e.sent,a.setState({groupConvos:c}),e.next=23;break;case 18:if("incoming"!==r){e.next=23;break}return e.next=21,a.getCustomerConvos(a.props.activeTeamId,a.props.activeUser);case 21:o=e.sent,a.setState({customerConvos:o});case 23:a.state.activeConvoId===t.conversationId&&a.updateMessagesForActiveConversation();case 24:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.updateStateForNewConvo=function(){var e=Object(l.a)(i.a.mark(function e(t){var n,r,s,c;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("member"!==(n=t.type)){e.next=8;break}return e.next=4,a.getMemberConvos(a.props.activeTeamId,a.props.activeUser);case 4:r=e.sent,a.setState({memberConvos:r}),e.next=23;break;case 8:if("group"!==n){e.next=15;break}return e.next=11,a.getGroupConvos(a.props.activeTeamId,a.props.activeUser);case 11:s=e.sent,a.setState({groupConvos:s}),e.next=23;break;case 15:if("incoming"!==n){e.next=23;break}return e.next=18,a.getCustomerConvos(a.props.activeTeamId,a.props.activeUser);case 18:return c=e.sent,e.next=21,a.initializeCustomerConvoStatus_IfNeeded(c,a.props.activeUser);case 21:c=e.sent,a.setState({customerConvos:c});case 23:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.updateMessagesForActiveConversation=Object(l.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.fc.service("messages").find({query:{conversationId:a.state.activeConvoId}});case 2:return t=e.sent,e.next=5,a.setState({messages:t.data});case 5:case"end":return e.stop()}},e)})),a.groupNameChange=function(e){a.setState({groupName:e.target.value})},a.addGroup=function(){var e=Object(l.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n=a.state.teamMembers.map(function(e){return e._id}),e.next=4,x.fc.service("conversations").create({name:a.state.groupName,type:"group",teamId:a.props.activeTeamId,status:Object(m.a)({},a.props.activeUser._id,"replied"),userIds:n});case 4:a.setState({groupModal:!1,groupName:""});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.toggleConnectSMSModal=function(){a.setState({connectSMSModal:!a.state.connectSMSModal})},a.toggleGroupModal=function(e){e.preventDefault(),a.setState({groupModal:!a.state.groupModal})},a.addMember=function(e){e.preventDefault(),x.fc.service("users").find({query:{email:a.state.userEmail}}).then(function(e){e.data[0]&&e.data[0].email===a.state.userEmail?(console.log("user was found"),x.fc.service("users").patch(e.data[0]._id,{$push:{teamIds:a.props.activeTeamId}}).then(function(e){a.getData(a.props.activeTeamId,a.props.activeUser)})):(console.log("user was not found"),x.fc.service("teams").patch(a.props.activeTeamId,{$push:{invitedEmails:a.state.userEmail}}))}),a.setState({userModal:!1})},a.emailChange=function(e){a.setState({userEmail:e.target.value})},a.toggleEmail=function(e){e.preventDefault(),a.setState({userModal:!a.state.userModal})},a.openConversation=function(){var e=Object(l.a)(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n=t.currentTarget.id,e.next=4,x.fc.service("conversations").get(n);case 4:r=e.sent,a.setState({activeConvoId:n,activeConversation:r});case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.getData(this.props.activeTeamId,this.props.activeUser),x.fc.service("conversations").on("created",this.updateStateForNewConvo),x.fc.service("messages").on("created",this.updateStateForNewMessage)}},{key:"componentDidUpdate",value:function(e,t){e.activeUser===this.props.activeUser&&e.activeTeamId===this.props.activeTeamId&&t.teamMembers.length===this.state.teamMembers.length||this.getData(this.props.activeTeamId,this.props.activeUser),e.activeTeamId!==this.props.activeTeamId&&this.setState({activeConvoId:"",activeConversation:null,messages:[]}),this.state.activeConvoId&&this.state.activeConvoId!==t.activeConvoId&&(this.updateMessagesForActiveConversation(),this.unreadToUnreplied())}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"row",id:"team-page"},r.a.createElement("div",{className:"col-4 flex-column justify-content-center border-right convoView"},r.a.createElement(q,{teamName:this.state.teamName,activeUser:this.props.activeUser,teamChange:this.props.teamChange}),r.a.createElement("div",null,r.a.createElement(H,Object.assign({addGroup:this.addGroup,value:this.state.groupName,modalStatus:this.state.groupModal,groupNameHandler:this.groupNameChange,toggleModal:this.toggleGroupModal},this.props)),this.state.groupConvos.length>0?this.state.groupConvos.map(function(t){return r.a.createElement(Z,Object.assign({key:t._id,activeConvoId:e.state.activeConvoId,activeUserId:e.props.activeUser._id,openConversation:e.openConversation},t))}):r.a.createElement("h6",{className:"listItem"},null),r.a.createElement(R,Object.assign({addMember:this.addMember,modalStatus:this.state.userModal,emailChange:this.emailChange,value:this.state.userEmail},this.props,{toggleModal:this.toggleEmail})),this.state.memberConvos.length>0?this.state.memberConvos.map(function(t){return r.a.createElement(Z,Object.assign({key:t._id,activeConvoId:e.state.activeConvoId,activeUserId:e.props.activeUser._id,openConversation:e.openConversation},t))}):r.a.createElement("h3",{className:"listItem"},null),r.a.createElement(J,Object.assign({teamSMS:this.state.teamSMS,activeTeamId:this.props.activeTeamId,modalState:this.state.connectSMSModal,toggle:this.toggleConnectSMSModal},this.props)),this.state.customerConvos.length>0?this.state.customerConvos.map(function(t){return r.a.createElement(Z,Object.assign({key:t._id,activeConvoId:e.state.activeConvoId,activeUserId:e.props.activeUser._id,openConversation:e.openConversation},t))}):r.a.createElement("h6",{className:"listItem"},null))),r.a.createElement(X,{getMessages:this.updateMessagesForActiveConversation,messages:this.state.messages,activeUser:this.props.activeUser,conversationId:this.state.activeConvoId,conversation:this.state.activeConversation}))}}]),t}(r.a.Component);var te=function(e){return r.a.createElement("div",null,e.activeTeamId?r.a.createElement(ee,e):r.a.createElement(_,{teamCreate:e.teamCreate,teamNameInput:e.teamNameInput}))},ae=a(160);var ne=function(e){var t=e.component,a=e.token,n=e.activeTeamId,s=e.activeUser,c=e.teamNameInput,o=e.teamCreate,i=e.teamChange,l=e.teamName,m=Object(ae.a)(e,["component","token","activeTeamId","activeUser","teamNameInput","teamCreate","teamChange","teamName"]);return r.a.createElement(g.b,Object.assign({},m,{render:function(e){return a?r.a.createElement(t,Object.assign({activeTeamId:n,activeUser:s,teamCreate:o,teamNameInput:c,teamChange:i,teamName:l},e)):r.a.createElement(g.a,{to:{pathname:"/register",state:{from:e.location}}})}}))},re=(a(303),function(e){function t(){var e,a;Object(u.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(d.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).state={token:!1,activeUser:{},activeTeamId:"",teamInput:""},a.teamChange=function(e){e.preventDefault(),x.fc.service("users").patch(a.state.activeUser,{activeTeamId:e.target.value}),a.setState({activeTeamId:e.target.value})},a.teamNameInput=function(e){var t;a.setState((t={},Object(m.a)(t,e.target.name,e.target.value),Object(m.a)(t,"error",null),t))},a.teamCreate=function(e){x.fc.service("teams").create({name:a.state.teamInput}).then(function(e){a.setState({activeTeamId:e._id})})},a}return Object(h.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=this;x.fc.authenticate().catch(function(){}),x.fc.on("authenticated",function(t){(function(){var t=Object(l.a)(i.a.mark(function t(a){var n,r,s,c;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x.fc.passport.verifyJWT(a);case 2:return n=t.sent,t.next=5,x.fc.service("users").get(n.userId);case 5:return r=t.sent,t.next=8,x.fc.service("teams").find({query:{invitedEmails:r.email}});case 8:if(1!==(s=t.sent).data.length){t.next=22;break}return c=s.data[0]._id,t.next=13,x.fc.service("users").patch(r,{$push:{teamIds:c}});case 13:return r=t.sent,t.next=16,x.fc.service("users").patch(r,{activeTeamId:c});case 16:return r=t.sent,t.next=19,x.fc.service("teams").patch(c,{$pull:{invitedEmails:r.email}});case 19:t.sent,t.next=23;break;case 22:s.data.length>1&&console.log("more than one invitation, check App.js to add this functionality");case 23:e.setState({token:a,activeUser:r,activeTeamId:r.activeTeamId});case 24:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}})()(t.accessToken)}),x.fc.on("logout",function(t){e.setState({token:null})})}},{key:"render",value:function(){var e=this;return r.a.createElement(f.a,null,r.a.createElement(g.b,{path:"/",exact:!0,component:N}),r.a.createElement(g.b,{path:"/login",exact:!0,render:function(t){return r.a.createElement(y,Object.assign({token:e.state.token},t))}}),r.a.createElement(g.b,{path:"/register",exact:!0,render:function(t){return r.a.createElement(w,Object.assign({token:e.state.token},t))}}),r.a.createElement(ne,{path:"/home",exact:!0,token:this.state.token,activeTeamId:this.state.activeTeamId,activeUser:this.state.activeUser,teamNameInput:this.teamNameInput,teamCreate:this.teamCreate,teamName:this.state.teamInput,teamChange:this.teamChange,component:te}))}}]),t}(n.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(304);c.a.render(r.a.createElement(re,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},5:function(e,t,a){var n=a(176),r=a(190),s=a(195),c=a(223),o=s("https://frontdor.herokuapp.com"),i=n();i.configure(r(o)),i.configure(c({storage:window.localStorage})),e.exports={fc:i}}},[[161,1,2]]]);
//# sourceMappingURL=main.deaf4705.chunk.js.map